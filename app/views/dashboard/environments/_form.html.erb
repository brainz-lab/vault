<%= form_with model: [@current_project, environment], url: environment.persisted? ? dashboard_project_environment_path(@current_project, environment) : dashboard_project_environments_path(@current_project), class: "card mt-8 p-6 space-y-6" do |f| %>
  <% if environment.errors.any? %>
    <div class="alert-error">
      <ul class="list-disc list-inside text-sm text-red-700">
        <% environment.errors.full_messages.each do |message| %>
          <li><%= message %></li>
        <% end %>
      </ul>
    </div>
  <% end %>

  <div>
    <%= f.label :name, class: "form-label" %>
    <%= f.text_field :name, class: "form-input", placeholder: "Production" %>
  </div>

  <div>
    <%= f.label :slug, class: "form-label" %>
    <%= f.text_field :slug, class: "form-input font-mono lowercase",
        placeholder: "production",
        disabled: environment.persisted? %>
    <p class="form-hint">Lowercase letters, numbers, and hyphens only</p>
  </div>

  <div>
    <%= f.label :parent_environment_id, "Inherits From", class: "form-label" %>
    <%= f.select :parent_environment_id,
        options_for_select(
          [["None", ""]] + @current_project.secret_environments.where.not(id: environment.id).map { |e| [e.name, e.id] },
          environment.parent_environment_id
        ),
        {}, class: "form-input" %>
    <p class="form-hint">If a secret doesn't exist in this environment, it will be inherited from the selected environment</p>
  </div>

  <div>
    <%= f.label :position, class: "form-label" %>
    <%= f.number_field :position, class: "form-input", min: 0 %>
    <p class="form-hint">Display order (lower numbers appear first)</p>
  </div>

  <div class="rounded-lg border border-stone-200 p-4 bg-stone-50">
    <label class="flex items-start cursor-pointer group">
      <%= f.check_box :locked, class: "form-checkbox mt-0.5" %>
      <span class="ml-3">
        <span class="flex items-center text-sm font-medium text-stone-900 group-hover:text-orange-600 transition-colors">
          <svg class="h-4 w-4 mr-1.5 text-red-500" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5">
            <path stroke-linecap="round" stroke-linejoin="round" d="M16.5 10.5V6.75a4.5 4.5 0 10-9 0v3.75m-.75 11.25h10.5a2.25 2.25 0 002.25-2.25v-6.75a2.25 2.25 0 00-2.25-2.25H6.75a2.25 2.25 0 00-2.25 2.25v6.75a2.25 2.25 0 002.25 2.25z" />
          </svg>
          Locked Environment
        </span>
        <span class="block text-xs text-stone-500 mt-0.5">Require additional approval for changes</span>
      </span>
    </label>
  </div>

  <div class="flex justify-end gap-3 pt-6 border-t border-stone-100">
    <%= link_to "Cancel", dashboard_project_environments_path(@current_project), class: "btn-secondary" %>
    <%= f.submit environment.persisted? ? "Update Environment" : "Create Environment", class: "btn-primary cursor-pointer" %>
  </div>
<% end %>
