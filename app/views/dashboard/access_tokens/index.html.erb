<% content_for :title, "Access Tokens" %>

<div class="sm:flex sm:items-center">
  <div class="sm:flex-auto">
    <h1 class="text-2xl font-semibold text-gray-900">Access Tokens</h1>
    <p class="mt-2 text-sm text-gray-700">API tokens for accessing secrets programmatically</p>
  </div>
  <div class="mt-4 sm:ml-16 sm:mt-0 sm:flex-none">
    <%= link_to "New Token", new_dashboard_project_access_token_path(@current_project),
        class: "inline-flex items-center rounded-md bg-indigo-600 px-3 py-2 text-sm font-semibold text-white shadow-sm hover:bg-indigo-500" %>
  </div>
</div>

<div class="mt-8 overflow-hidden rounded-lg bg-white shadow">
  <table class="min-w-full divide-y divide-gray-200">
    <thead class="bg-gray-50">
      <tr>
        <th scope="col" class="px-6 py-3 text-left text-xs font-medium uppercase tracking-wide text-gray-500">Name</th>
        <th scope="col" class="px-6 py-3 text-left text-xs font-medium uppercase tracking-wide text-gray-500">Scopes</th>
        <th scope="col" class="px-6 py-3 text-left text-xs font-medium uppercase tracking-wide text-gray-500">Last Used</th>
        <th scope="col" class="px-6 py-3 text-left text-xs font-medium uppercase tracking-wide text-gray-500">Status</th>
        <th scope="col" class="relative px-6 py-3"><span class="sr-only">Actions</span></th>
      </tr>
    </thead>
    <tbody class="divide-y divide-gray-200 bg-white">
      <% @tokens.each do |token| %>
        <tr class="<%= token.revoked? ? 'opacity-50' : '' %>">
          <td class="whitespace-nowrap px-6 py-4">
            <div class="flex items-center">
              <span class="text-lg mr-2">üîê</span>
              <div>
                <p class="text-sm font-medium text-gray-900"><%= token.name %></p>
                <p class="text-xs text-gray-500">
                  <%= token.token_prefix %>...
                </p>
              </div>
            </div>
          </td>
          <td class="px-6 py-4">
            <div class="flex flex-wrap gap-1">
              <% token.scopes.each do |scope| %>
                <span class="inline-flex items-center rounded-full bg-blue-100 px-2 py-0.5 text-xs font-medium text-blue-800"><%= scope %></span>
              <% end %>
            </div>
          </td>
          <td class="whitespace-nowrap px-6 py-4 text-sm text-gray-500">
            <%= token.last_used_at ? "#{time_ago_in_words(token.last_used_at)} ago" : "Never" %>
          </td>
          <td class="whitespace-nowrap px-6 py-4">
            <% if token.revoked? %>
              <span class="inline-flex items-center rounded-full bg-red-100 px-2.5 py-0.5 text-xs font-medium text-red-800">Revoked</span>
            <% elsif token.expired? %>
              <span class="inline-flex items-center rounded-full bg-yellow-100 px-2.5 py-0.5 text-xs font-medium text-yellow-800">Expired</span>
            <% else %>
              <span class="inline-flex items-center rounded-full bg-green-100 px-2.5 py-0.5 text-xs font-medium text-green-800">Active</span>
            <% end %>
          </td>
          <td class="whitespace-nowrap px-6 py-4 text-right text-sm font-medium">
            <% unless token.revoked? %>
              <%= link_to "Edit", edit_dashboard_project_access_token_path(@current_project, token), class: "text-indigo-600 hover:text-indigo-900 mr-3" %>
              <%= button_to "Revoke", dashboard_project_access_token_path(@current_project, token),
                  method: :delete,
                  data: { confirm: "Revoke this token? This cannot be undone." },
                  class: "text-red-600 hover:text-red-900" %>
            <% end %>
          </td>
        </tr>
      <% end %>
      <% if @tokens.empty? %>
        <tr>
          <td colspan="5" class="px-6 py-12 text-center">
            <span class="text-4xl">üîê</span>
            <h3 class="mt-2 text-sm font-semibold text-gray-900">No tokens</h3>
            <p class="mt-1 text-sm text-gray-500">Create a token to access secrets via API.</p>
          </td>
        </tr>
      <% end %>
    </tbody>
  </table>
</div>
