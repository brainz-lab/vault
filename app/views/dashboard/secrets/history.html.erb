<% content_for :title, "#{@secret.key} History" %>

<div class="sm:flex sm:items-center">
  <div class="sm:flex-auto">
    <h1 class="text-2xl font-semibold text-gray-900"><%= @secret.key %> History</h1>
    <p class="mt-2 text-sm text-gray-700">Version history for <%= @environment.name %></p>
  </div>
  <div class="mt-4 sm:ml-16 sm:mt-0 sm:flex-none">
    <%= link_to "Back to Secret", dashboard_project_secret_path(@current_project, @secret),
        class: "inline-flex items-center rounded-md bg-white px-3 py-2 text-sm font-semibold text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 hover:bg-gray-50" %>
  </div>
</div>

<div class="mt-8 flow-root">
  <ul class="-mb-8">
    <% @versions.each_with_index do |version, idx| %>
      <li>
        <div class="relative pb-8">
          <% if idx != @versions.length - 1 %>
            <span class="absolute left-4 top-4 -ml-px h-full w-0.5 bg-gray-200" aria-hidden="true"></span>
          <% end %>
          <div class="relative flex space-x-3">
            <div>
              <span class="h-8 w-8 rounded-full flex items-center justify-center ring-8 ring-white <%= version.version == @secret.current_version_number ? 'bg-green-500' : 'bg-gray-400' %>">
                <span class="text-white text-xs font-bold"><%= version.version %></span>
              </span>
            </div>
            <div class="flex min-w-0 flex-1 justify-between space-x-4 pt-1.5">
              <div>
                <p class="text-sm text-gray-500">
                  <% if version.version == @secret.current_version_number %>
                    <span class="font-medium text-green-600">Current version</span>
                  <% else %>
                    Version <%= version.version %>
                  <% end %>
                  <% if version.note.present? %>
                    <span class="mx-1">â€”</span>
                    <span class="text-gray-700"><%= version.note %></span>
                  <% end %>
                </p>
                <p class="mt-1 text-xs text-gray-400">
                  <% if version.created_by_name.present? %>
                    by <%= version.created_by_name %>
                  <% end %>
                </p>
              </div>
              <div class="whitespace-nowrap text-right text-sm text-gray-500">
                <time datetime="<%= version.created_at.iso8601 %>"><%= version.created_at.strftime("%b %d, %Y %H:%M") %></time>
                <% if version.version != @secret.current_version_number %>
                  <div class="mt-1">
                    <%= button_to "Rollback", rollback_dashboard_project_secret_path(@current_project, @secret, version: version.version),
                        method: :post,
                        data: { confirm: "Roll back to version #{version.version}?" },
                        class: "text-xs text-indigo-600 hover:text-indigo-500" %>
                  </div>
                <% end %>
              </div>
            </div>
          </div>
        </div>
      </li>
    <% end %>
    <% if @versions.empty? %>
      <li class="text-center py-12">
        <p class="text-sm text-gray-500">No versions in this environment</p>
      </li>
    <% end %>
  </ul>
</div>
