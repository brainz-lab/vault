<%# OTP Setup partial - shows provisioning URI for authenticator app setup %>
<%# Usage: render "dashboard/secrets/otp_setup", secret: @secret, environment: @environment %>

<% if secret.otp_enabled? %>
<div class="card" id="otp-setup">
  <div class="card-body">
    <div class="flex items-center justify-between mb-4">
      <h2 class="text-lg font-semibold flex items-center" style="color: var(--color-ink-900);">
        <svg class="h-5 w-5 mr-2 text-emerald-500" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5">
          <path stroke-linecap="round" stroke-linejoin="round" d="M10.5 1.5H8.25A2.25 2.25 0 006 3.75v16.5a2.25 2.25 0 002.25 2.25h7.5A2.25 2.25 0 0018 20.25V3.75a2.25 2.25 0 00-2.25-2.25H13.5m-3 0V3h3V1.5m-3 0h3m-3 18.75h3" />
        </svg>
        Authenticator Setup
      </h2>
      <span class="badge bg-emerald-100 text-emerald-700"><%= secret.secret_type == "hotp" ? "HOTP" : "TOTP" %></span>
    </div>

    <p class="text-sm mb-4" style="color: var(--color-ink-500);">
      Scan this QR code with your authenticator app (Google Authenticator, Authy, 1Password, etc.) to set up OTP.
    </p>

    <%# QR Code placeholder - in production you'd use a QR code library %>
    <div class="flex justify-center mb-4">
      <div class="p-4 bg-white rounded-xl border" style="border-color: var(--color-cream-200);">
        <div class="w-48 h-48 flex items-center justify-center bg-gray-100 rounded-lg" id="qr-code-<%= secret.id %>">
          <svg class="h-12 w-12 text-gray-400 animate-pulse" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1">
            <path stroke-linecap="round" stroke-linejoin="round" d="M3.75 4.875c0-.621.504-1.125 1.125-1.125h4.5c.621 0 1.125.504 1.125 1.125v4.5c0 .621-.504 1.125-1.125 1.125h-4.5A1.125 1.125 0 013.75 9.375v-4.5zM3.75 14.625c0-.621.504-1.125 1.125-1.125h4.5c.621 0 1.125.504 1.125 1.125v4.5c0 .621-.504 1.125-1.125 1.125h-4.5a1.125 1.125 0 01-1.125-1.125v-4.5zM13.5 4.875c0-.621.504-1.125 1.125-1.125h4.5c.621 0 1.125.504 1.125 1.125v4.5c0 .621-.504 1.125-1.125 1.125h-4.5A1.125 1.125 0 0113.5 9.375v-4.5z" />
            <path stroke-linecap="round" stroke-linejoin="round" d="M6.75 6.75h.75v.75h-.75v-.75zM6.75 16.5h.75v.75h-.75v-.75zM16.5 6.75h.75v.75h-.75v-.75zM13.5 13.5h.75v.75h-.75v-.75zM13.5 19.5h.75v.75h-.75v-.75zM19.5 13.5h.75v.75h-.75v-.75zM19.5 19.5h.75v.75h-.75v-.75zM16.5 16.5h.75v.75h-.75v-.75z" />
          </svg>
        </div>
      </div>
    </div>

    <%# Manual entry section %>
    <details class="group">
      <summary class="cursor-pointer text-sm font-medium transition-colors flex items-center justify-center hover:text-emerald-600" style="color: var(--color-ink-600);">
        <svg class="h-4 w-4 mr-1 transform group-open:rotate-90 transition-transform" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
          <path stroke-linecap="round" stroke-linejoin="round" d="M8.25 4.5l7.5 7.5-7.5 7.5" />
        </svg>
        Can't scan? Enter manually
      </summary>
      <div class="mt-4 space-y-3 p-4 rounded-lg bg-slate-50">
        <div>
          <p class="text-xs font-medium uppercase tracking-wide mb-1" style="color: var(--color-ink-400);">Account</p>
          <p class="text-sm font-mono" style="color: var(--color-ink-800);"><%= secret.username || secret.key %></p>
        </div>
        <% if secret.otp_issuer.present? %>
          <div>
            <p class="text-xs font-medium uppercase tracking-wide mb-1" style="color: var(--color-ink-400);">Issuer</p>
            <p class="text-sm font-mono" style="color: var(--color-ink-800);"><%= secret.otp_issuer %></p>
          </div>
        <% end %>
        <div>
          <p class="text-xs font-medium uppercase tracking-wide mb-1" style="color: var(--color-ink-400);">Type</p>
          <p class="text-sm font-mono" style="color: var(--color-ink-800);"><%= secret.secret_type == "hotp" ? "Counter-based (HOTP)" : "Time-based (TOTP)" %></p>
        </div>
        <div>
          <p class="text-xs font-medium uppercase tracking-wide mb-1" style="color: var(--color-ink-400);">Algorithm</p>
          <p class="text-sm font-mono" style="color: var(--color-ink-800);"><%= (secret.otp_algorithm || "sha1").upcase %></p>
        </div>
        <div>
          <p class="text-xs font-medium uppercase tracking-wide mb-1" style="color: var(--color-ink-400);">Digits</p>
          <p class="text-sm font-mono" style="color: var(--color-ink-800);"><%= secret.otp_digits || 6 %></p>
        </div>
        <% if secret.secret_type != "hotp" %>
          <div>
            <p class="text-xs font-medium uppercase tracking-wide mb-1" style="color: var(--color-ink-400);">Period</p>
            <p class="text-sm font-mono" style="color: var(--color-ink-800);"><%= secret.otp_period || 30 %> seconds</p>
          </div>
        <% end %>
      </div>
    </details>

    <p class="mt-4 text-xs text-center" style="color: var(--color-ink-400);">
      <svg class="h-3.5 w-3.5 inline mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5">
        <path stroke-linecap="round" stroke-linejoin="round" d="M12 9v3.75m9-.75a9 9 0 11-18 0 9 9 0 0118 0zm-9 3.75h.008v.008H12v-.008z" />
      </svg>
      The OTP secret is stored encrypted in Vault. Your authenticator app will need to be set up separately.
    </p>
  </div>
</div>
<% end %>
