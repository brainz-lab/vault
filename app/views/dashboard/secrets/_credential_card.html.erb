<%# Credential quick-copy card partial %>
<%# Usage: render "dashboard/secrets/credential_card", secret: @secret, environment: @environment, value: @value %>

<% if secret.credential? || secret.otp_enabled? %>
<div class="card" id="credential-card">
  <div class="card-body">
    <div class="flex items-center justify-between mb-4">
      <h2 class="text-lg font-semibold flex items-center" style="color: var(--color-ink-900);">
        <svg class="h-5 w-5 mr-2 text-blue-500" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5">
          <path stroke-linecap="round" stroke-linejoin="round" d="M15.75 6a3.75 3.75 0 11-7.5 0 3.75 3.75 0 017.5 0zM4.501 20.118a7.5 7.5 0 0114.998 0A17.933 17.933 0 0112 21.75c-2.676 0-5.216-.584-7.499-1.632z" />
        </svg>
        Quick Copy
      </h2>
      <span class="badge bg-blue-100 text-blue-700"><%= secret.secret_type&.titleize || "Credential" %></span>
    </div>

    <div class="space-y-3">
      <%# Username row %>
      <% if secret.username.present? %>
        <div class="flex items-center justify-between p-3 rounded-lg" style="background: var(--color-cream-50);">
          <div class="flex-1 min-w-0">
            <p class="text-xs font-medium uppercase tracking-wide mb-1" style="color: var(--color-ink-400);">Username</p>
            <p class="text-sm font-mono truncate" style="color: var(--color-ink-800);"><%= secret.username %></p>
          </div>
          <button type="button"
                  class="ml-3 flex-shrink-0 btn-secondary btn-sm"
                  onclick="navigator.clipboard.writeText('<%= j secret.username %>').then(() => { this.textContent = 'Copied!'; setTimeout(() => this.textContent = 'Copy', 1500); })">
            Copy
          </button>
        </div>
      <% end %>

      <%# Password row %>
      <div class="flex items-center justify-between p-3 rounded-lg" style="background: var(--color-cream-50);">
        <div class="flex-1 min-w-0" data-controller="secret-reveal">
          <p class="text-xs font-medium uppercase tracking-wide mb-1" style="color: var(--color-ink-400);">Password</p>
          <div class="flex items-center">
            <span data-secret-reveal-target="hidden" class="text-sm font-mono" style="color: var(--color-ink-800);">••••••••••••</span>
            <span data-secret-reveal-target="value" class="text-sm font-mono hidden" style="color: var(--color-ink-800);"><%= value %></span>
            <button type="button" class="ml-2 text-xs font-medium px-1.5 py-0.5 rounded hover:bg-white/50" style="color: var(--color-ink-500);" data-action="click->secret-reveal#toggle" data-secret-reveal-target="button">Show</button>
          </div>
        </div>
        <button type="button"
                class="ml-3 flex-shrink-0 btn-secondary btn-sm"
                onclick="navigator.clipboard.writeText('<%= j value %>').then(() => { this.textContent = 'Copied!'; setTimeout(() => this.textContent = 'Copy', 1500); })">
          Copy
        </button>
      </div>

      <%# OTP row (if enabled) %>
      <% if secret.otp_enabled? %>
        <div class="flex items-center justify-between p-3 rounded-lg bg-emerald-50" data-controller="otp-display" data-otp-display-url-value="<%= generate_otp_dashboard_project_secret_path(local_assigns[:project] || @current_project, secret) %>" data-otp-display-type-value="<%= secret.secret_type %>" data-otp-display-period-value="<%= secret.otp_period || 30 %>">
          <div class="flex-1 min-w-0">
            <p class="text-xs font-medium uppercase tracking-wide mb-1 text-emerald-600">OTP Code</p>
            <div class="flex items-center gap-3">
              <span class="text-lg font-mono font-bold text-emerald-800" data-otp-display-target="code">------</span>
              <% if secret.secret_type != "hotp" %>
                <span class="text-xs text-emerald-600" data-otp-display-target="countdown">--s</span>
              <% end %>
            </div>
          </div>
          <button type="button"
                  class="ml-3 flex-shrink-0 btn-secondary btn-sm bg-emerald-100 text-emerald-700 hover:bg-emerald-200"
                  data-action="click->otp-display#copy">
            Copy
          </button>
        </div>
      <% end %>
    </div>

    <%# Copy All button %>
    <div class="mt-4 pt-4 border-t" style="border-color: var(--color-cream-200);">
      <button type="button"
              class="btn-primary w-full justify-center"
              onclick="copyAllCredentials(this, '<%= j secret.username %>', '<%= j value %>')">
        <svg class="h-4 w-4 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5">
          <path stroke-linecap="round" stroke-linejoin="round" d="M15.666 3.888A2.25 2.25 0 0013.5 2.25h-3c-1.03 0-1.9.693-2.166 1.638m7.332 0c.055.194.084.4.084.612v0a.75.75 0 01-.75.75H9a.75.75 0 01-.75-.75v0c0-.212.03-.418.084-.612m7.332 0c.646.049 1.288.11 1.927.184 1.1.128 1.907 1.077 1.907 2.185V19.5a2.25 2.25 0 01-2.25 2.25H6.75A2.25 2.25 0 014.5 19.5V6.257c0-1.108.806-2.057 1.907-2.185a48.208 48.208 0 011.927-.184" />
        </svg>
        Copy All to Clipboard
      </button>
    </div>
  </div>
</div>

<script>
function copyAllCredentials(button, username, password) {
  const text = `Username: ${username}\nPassword: ${password}`;
  navigator.clipboard.writeText(text).then(() => {
    const originalHTML = button.innerHTML;
    button.innerHTML = '<svg class="h-4 w-4 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5"><path stroke-linecap="round" stroke-linejoin="round" d="M4.5 12.75l6 6 9-13.5" /></svg>Copied!';
    setTimeout(() => button.innerHTML = originalHTML, 2000);
  });
}
</script>
<% end %>
